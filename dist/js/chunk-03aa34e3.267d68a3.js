(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-03aa34e3"],{"542b":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"coverage-manage"}},[a("base-manage",{ref:"baseManage",attrs:{title:t.title,fields:t.fields,"system-path":"coverage","filter-list":t.filterList},on:{addNew:t.addNew,edit:t.edit,changeStatus:t.changeStatus}}),a("coverage-modal",{ref:"coverageModal",attrs:{mode:t.mode},on:{refresh:t.refresh}}),a("status-manage-modal",{ref:"statusManageModal",attrs:{system:"converage","select-task-info":t.selectTaskInfo},on:{refresh:t.refresh},model:{value:t.status,callback:function(e){t.status=e},expression:"status"}})],1)},n=[],o=a("b7f9"),i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("va-modal",{attrs:{"auto-close":t.$store.getters.FALSE,title:t.getTitle},on:{ok:t.submit},model:{value:t.open,callback:function(e){t.open=e},expression:"open"}},[a("va-select",{attrs:{options:t.appOptions,label:"所属应用","text-by":"appName"},model:{value:t.appId,callback:function(e){t.appId=e},expression:"appId"}}),a("va-input",{staticClass:"app-modal-input",attrs:{label:"需求名称"},model:{value:t.taskName,callback:function(e){t.taskName=e},expression:"taskName"}}),a("va-input",{staticClass:"app-modal-input",attrs:{label:"文件过滤条件",placeholder:"工程package通用路径，例如：com.dmall.trade.* "},model:{value:t.fileFilters,callback:function(e){t.fileFilters=e},expression:"fileFilters"}}),a("va-input",{staticClass:"app-modal-input",attrs:{label:"消息过滤条件",placeholder:'参考grep多条件以|隔开，禁用*，例如："Id":"1"|"name":"test"'},model:{value:t.msgFilters,callback:function(e){t.msgFilters=e},expression:"msgFilters"}}),t.showRate?a("va-progress-bar",{attrs:{buffer:t.rate}}):t._e()],1)},r=[],l=(a("6762"),a("2fdb"),a("860f")),c=a("7a71"),u=a("2e27"),p=a("4202"),d=a("4360"),f={name:"CoverageModal",components:{VaProgressBar:p["a"],VaSelect:u["a"],VaInput:c["a"],VaModal:l["a"]},props:{mode:{type:String,required:!0}},data:function(){return{appOptions:[],appId:"",taskName:"",fileFilters:"",msgFilters:"",open:!1,taskId:"",rate:0,showRate:!1}},computed:{getTitle:function(){return this.$store.getters.getModeName(this.mode)+"覆盖率统计"}},methods:{openModal:function(){this.open=!0},closeModal:function(){this.open=!1},submit:function(){var t=this;this.showRate=!1,this.rate=0,""!==this.appId&&""!==this.taskName&&""!==this.fileFilters&&""!==this.msgFilters?"*"!==this.fileFilters?this.msgFilters.includes("*")?this.$swal({type:"error",confirmButtonColor:"#4ae387",text:"为了运行稳定，消息过滤禁止为全匹配"}):this.$axios.post("/coverage/save",{appId:this.appId.id,taskName:this.taskName,fileFilters:this.fileFilters,msgFilters:this.msgFilters}).then(function(e){e.data.success?(t.taskId=e.data.data,t.getRate()):t.$swal({type:"error",confirmButtonColor:"#4ae387",text:e.data.msg})}):this.$swal({type:"error",confirmButtonColor:"#4ae387",text:"为了运行稳定，文件过滤禁止为全匹配"}):this.$swal({type:"error",confirmButtonColor:"#4ae387",text:"所有参数都是必填项，请检查后提交"})},getRate:function(){var t=this;this.webSocket=new WebSocket("".concat(d["a"].getters.getWebSocketBaseUrl())),this.webSocket.onopen=function(){t.webSocket.send("1@".concat(t.taskId)),t.showRate=!0},this.webSocket.onmessage=function(e){t.rate=e.data},this.webSocket.onerror=function(e){t.$swal({type:"error",confirmButtonColor:"#4ae387",text:e})},this.webSocket.onclose=function(){"100"===t.rate?t.$swal({type:"success",confirmButtonColor:"#4ae387",text:"Success!"}).then(function(){t.$emit("refresh"),t.closeModal()}):t.$swal({type:"error",confirmButtonColor:"#4ae387",text:"系统错误"}).then(function(){})}}},created:function(){var t=this,e={pageSize:10,pageNum:1};this.$axios.post("/application/filter",e).then(function(e){e.data.success?t.appOptions=e.data.data.resultList:t.$swal({type:"error",confirmButtonColor:"#4ae387",text:e.data.msg})})}},m=f,h=(a("c30e"),a("2877")),g=Object(h["a"])(m,i,r,!1,null,"5525f3ab",null),b=g.exports,v=a("e7c8"),w={name:"CoverageManage",components:{StatusManageModal:v["a"],CoverageModal:b,BaseManage:o["a"]},data:function(){return{title:"覆盖率统计",fields:[{name:"id",title:"ID"},{name:"appName",title:"应用名称"},{name:"taskName",title:"需求名称"},{name:"fileFilters",title:"文件过滤条件"},{name:"msgFilters",title:"消息过滤条件"},{name:"msgCount",title:"请求数"},{name:"totalCoverage",title:"总覆盖率"},{name:"createTime",title:"开始时间",callback:function(t){return d["a"].getters.getFormatDate(t)}},{name:"modifyTime",title:"修改时间",callback:function(t){return d["a"].getters.getFormatDate(t)}},{name:"__slot:redisStateSlot",title:"状态"},{name:"__slot:actionsSlot",title:"操作"}],filterList:["appName","requirementName"],mode:"",status:0,selectTaskInfo:{}}},methods:{addNew:function(){this.mode="new",this.$refs.coverageModal.openModal()},edit:function(t){},changeStatus:function(t){this.status=t.taskStatus,this.selectTaskInfo=t,0!==this.status?4!==this.status?this.$refs.statusManageModal.openModal():this.$swal({title:"Error",text:"已终止，无法修改状态",type:"error",confirmButtonColor:"#4ae387"}):this.$swal({title:"Error",text:"准备中，无法修改状态；请等待状态为待运行后再次点击",type:"error",confirmButtonColor:"#4ae387"})},refresh:function(){this.$refs.baseManage.getFilterPage()}}},k=w,x=Object(h["a"])(k,s,n,!1,null,"382c85a9",null);e["default"]=x.exports},"99fb":function(t,e,a){},"9c42":function(t,e,a){"use strict";var s=a("ae0d"),n=a.n(s);n.a},ae0d:function(t,e,a){},b7f9:function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"base-manage"}},[a("va-card",{attrs:{title:t.title}}),a("base-filter",{staticClass:"mt-4",attrs:{"filter-list":t.filterList},on:{click:t.clickFilter,addNew:t.addNew}}),a("base-table",t._g({staticClass:"mt-4",attrs:{fields:t.fields,data:t.tableData,"per-page":t.perPage,"total-pages":t.totalPages},on:{pageSelected:t.pageSelected,remove:t.remove}},t.$listeners))],1)},n=[],o=(a("d25f"),a("ac6a"),a("456d"),a("6762"),a("2fdb"),a("c5f6"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"base-filter"}},[t.showFilter?a("va-card",{attrs:{title:"Filter"}},[a("div",{staticClass:"va-row row filter-part"},[t.show("appId")?a("va-select",{staticClass:"flex xl3",attrs:{label:"应用名称",options:t.appList,"text-by":"appName"},model:{value:t.appInfo,callback:function(e){t.appInfo=e},expression:"appInfo"}}):t._e(),t.show("appName")?a("va-select",{staticClass:"flex xl3",attrs:{label:"应用名称",options:t.appList,"text-by":"appName"},model:{value:t.appContent,callback:function(e){t.appContent=e},expression:"appContent"}}):t._e(),t.show("gitLabUrl")?a("va-input",{staticClass:"flex xl3",attrs:{label:"gitlab项目链接"},model:{value:t.gitLabUrl,callback:function(e){t.gitLabUrl=e},expression:"gitLabUrl"}}):t._e(),t.show("jenkinsJobName")?a("va-input",{staticClass:"flex xl3",attrs:{label:"jenkins项目名称"},model:{value:t.jenkinsJobName,callback:function(e){t.jenkinsJobName=e},expression:"jenkinsJobName"}}):t._e(),t.show("requirementName")?a("va-input",{staticClass:"flex xl3",attrs:{label:"需求名称"},model:{value:t.requirementName,callback:function(e){t.requirementName=e},expression:"requirementName"}}):t._e(),t.show("className")?a("va-input",{staticClass:"flex xl3",attrs:{label:"类全称(com.xx.yService)"},model:{value:t.className,callback:function(e){t.className=e},expression:"className"}}):t._e(),t.show("methodName")?a("va-input",{staticClass:"flex xl3",attrs:{label:"方法全称"},model:{value:t.methodName,callback:function(e){t.methodName=e},expression:"methodName"}}):t._e(),t.show("description")?a("va-input",{staticClass:"flex xl3",attrs:{label:"介绍"},model:{value:t.description,callback:function(e){t.description=e},expression:"description"}}):t._e()],1),a("div",{staticClass:"va-row"},[a("va-button",{directives:[{name:"show",rawName:"v-show",value:t.showNew,expression:"showNew"}],staticClass:"base-filter-btn-new",on:{click:t.addNew}},[t._v("New")]),a("va-button",{staticClass:"base-filter-btn-filter",attrs:{color:"info"},on:{click:t.clickAction}},[t._v("Filter")])],1)]):t._e()],1)}),i=[],r=a("8fb3"),l=a("7a71"),c=a("0932"),u=a("4360"),p={name:"BaseFilter",components:{VaButton:c["a"],VaInput:l["a"],VaCard:r["a"]},props:{filterList:Array,showNew:{type:Boolean,default:!0}},computed:{showFilter:function(){return"undefined"!==typeof this.filterList&&this.filterList.length>0}},data:function(){return{appList:[],appInfo:"",appContent:"",gitLabUrl:"",jenkinsJobName:"",requirementName:"",className:"",methodName:"",description:""}},methods:{show:function(t){return this.filterList.includes(t)},addNew:function(){this.$emit("addNew")},clickAction:function(){var t={appId:this.appInfo.id,appName:this.appContent.appName,description:this.description,className:this.className,methodName:this.methodName};this.$emit("click",t)}},created:function(){var t=this,e={pageSize:200,pageNum:1};this.$axios.post("/application/filter",e).then(function(e){e.data.success?t.appList=e.data.data.resultList:t.$swal({type:"error",confirmButtonColor:"#4ae387",text:e.data.msg})})}},d=p,f=(a("9c42"),a("2877")),m=Object(f["a"])(d,o,i,!1,null,"1d73718e",null),h=m.exports,g=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"base-table"}},[a("va-card",[a("va-data-table",{attrs:{fields:t.fields,data:t.data,"per-page":t.perPage,"api-mode":t.apiMode,"total-pages":t.totalPages},on:{"page-selected":t.pageSelected},scopedSlots:t._u([{key:"redisStateSlot",fn:function(e){return[a("redis-status-template",t._g({attrs:{data:e.rowData},model:{value:e.rowData.taskStatus,callback:function(a){t.$set(e.rowData,"taskStatus",a)},expression:"props.rowData.taskStatus"}},t.$listeners))]}},{key:"actionsSlot",fn:function(e){return[a("actions-template",t._g({attrs:{data:e.rowData}},t.$listeners))]}}])})],1)],1)},b=[],v=a("04f4"),w=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("va-button",{attrs:{small:"",color:t.autoColor,"icon-right":t.showIcon},on:{click:t.changeStatus}},[t._v(t._s(t.getText))])},k=[],x={name:"RedisStatusTemplate",props:{value:Number,data:Object},computed:{getText:function(){return"undefined"!==typeof this.data.connect&&0===this.data.connect?"异常":u["a"].getters.getTaskStatusEnum(this.value)},autoColor:function(){if("undefined"!==typeof this.data.connect&&0===this.data.connect)return"danger";switch(this.value){case 0:return"gray";case 1:return"info";case 2:return"success";case 3:return"warning";case 4:return"danger";case 5:return"danger"}},showIcon:function(){return[1,2,3].includes(this.value)?"fa fa-cog":""}},methods:{changeStatus:function(){this.$emit("changeStatus",this.data)}}},y=x,N=Object(f["a"])(y,w,k,!1,null,"4c43331c",null),C=N.exports,$=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"actions-template"}},[a("va-button",{attrs:{flat:"",small:"",color:"gray",icon:"fa fa-pencil"},on:{click:t.edit}}),a("va-button",{attrs:{flat:"",small:"",color:"gray",icon:"fa fa-trash"},on:{click:t.remove}})],1)},S=[],_={name:"ActionsTemplate",props:{data:Object},methods:{edit:function(){this.$emit("edit",{param:this.data})},remove:function(){this.$emit("remove",{param:this.data})}}},I=_,B=Object(f["a"])(I,$,S,!1,null,"55445a51",null),F=B.exports,M={name:"BaseTable",components:{ActionsTemplate:F,RedisStatusTemplate:C,VaCard:r["a"],VaDataTable:v["a"]},props:{fields:{type:Array,required:!0},data:{type:Array,required:!0},perPage:{type:Number,default:10},totalPages:{type:Number,required:!0}},data:function(){return{apiMode:!0}},methods:{pageSelected:function(t){this.$emit("pageSelected",t)}}},T=M,P=Object(f["a"])(T,g,b,!1,null,"5afc1a2a",null),L=P.exports,j={name:"BaseManage",components:{VaCard:r["a"],BaseTable:L,BaseFilter:h},props:{title:{type:String,required:!0},systemPath:{type:String,required:!0},filterList:Array,fields:{type:Array,required:!0},perPage:{type:Number,default:10},initTable:{type:Boolean,default:!0}},data:function(){return{filter:{},tableData:[],totalPages:0,pageNum:1}},methods:{clickFilter:function(t){this.filter=t,this.getFilterPage()},addNew:function(){this.$emit("addNew")},remove:function(t){var e=this;4!==t.param.taskStatus?this.$swal({title:"Error",text:"请先结束规则后再尝试删除",type:"error",confirmButtonColor:"#4ae387"}):this.$swal({type:"warning",confirmButtonColor:"#4ae387",text:"确认删除该规则吗？"}).then(function(a){Object.keys(a).includes("value")&&!0===a["value"]&&e.$axios.post("/".concat(e.systemPath,"/remove"),t.param.id).then(function(t){t.data.success?(e.$swal({type:"success",confirmButtonColor:"#4ae387",text:t.data.msg}),e.getFilterPage()):e.$swal({type:"error",confirmButtonColor:"#4ae387",text:t.data.msg})})})},pageSelected:function(t){this.pageNum=t,this.getFilterPage()},getFilterPage:function(){var t=this,e=this.filter;e["pageSize"]=10,e["pageNum"]=this.pageNum,this.$axios.post("/".concat(this.systemPath,"/filter"),e).then(function(e){e.data.success?(t.totalPages=e.data.data.totalPages,t.tableData=e.data.data.resultList):t.$swal({type:"error",confirmButtonColor:"#4ae387",text:e.data.msg})})}},created:function(){this.initTable&&this.getFilterPage()}},O=j,A=Object(f["a"])(O,s,n,!1,null,"8b794c1e",null);e["a"]=A.exports},c30e:function(t,e,a){"use strict";var s=a("99fb"),n=a.n(s);n.a},e7c8:function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("va-modal",{attrs:{hideDefaultActions:t.$store.getters.TRUE,title:"状态管理"},on:{ok:t.submit},model:{value:t.open,callback:function(e){t.open=e},expression:"open"}},[t.showRun?a("va-button",{on:{click:t.run}},[t._v("运行")]):t._e(),t.showRetry?a("va-button",{on:{click:t.retry}},[t._v("重试")]):t._e(),t.showPause?a("va-button",{attrs:{color:"warning"},on:{click:t.pause}},[t._v("暂停")]):t._e(),a("va-button",{attrs:{color:"danger"},on:{click:t.terminal}},[t._v("终止")])],1)},n=[],o=(a("ac6a"),a("456d"),a("6762"),a("2fdb"),{name:"StatusManageModal",props:{system:{type:String,required:!0},selectTaskInfo:{}},data:function(){return{open:!1,selectedOption:this.value,status:this.selectTaskInfo.taskStatus,connect:this.selectTaskInfo.connect}},computed:{showRun:function(){return(1===this.status||3===this.status)&&(void 0===this.connect||1===this.connect)},showPause:function(){return 2===this.status&&(void 0===this.connect||1===this.connect)},showRetry:function(){return 0===this.connect||5===this.status}},watch:{selectedOption:function(){this.$emit("input",this.selectedOption)},selectTaskInfo:function(){this.status=this.selectTaskInfo.taskStatus,this.connect=this.selectTaskInfo.connect}},methods:{openModal:function(){this.open=!0},closeModal:function(){this.open=!1},submit:function(){},run:function(){this.baseAction(2,"为了环境稳定，请保证任务配置确定过滤合理！！确定开始吗？")},pause:function(){this.baseAction(3,"确定暂停吗？")},terminal:function(){this.baseAction(4,"一旦终止，无法再次开启，确定终止吗？")},retry:function(){var t=this;this.$swal({title:"Warning",text:"请确认目标服务健康 & 目标方法存在，点击确认将重新请求目标服务",type:"warning",confirmButtonColor:"#cbd3da",showCancelButton:!0,cancelButtonColor:"#e34a4a"}).then(function(e){Object.keys(e).includes("value")&&!0===e["value"]&&t.$axios.post("/"+t.system+"/retry",t.selectTaskInfo["id"]).then(function(e){e.data.success?t.$swal({type:"success",confirmButtonColor:"#4ae387",text:e.data.msg}).then(function(){t.$emit("refresh"),t.closeModal()}):t.$swal({type:"error",confirmButtonColor:"#4ae387",text:e.data.msg})})})},baseAction:function(t,e,a){var s=this;this.$swal({title:"Warning",text:e,type:"warning",confirmButtonColor:"#cbd3da",showCancelButton:!0,cancelButtonColor:"#e34a4a"}).then(function(e){if(Object.keys(e).includes("value")&&!0===e["value"]){var a={id:s.selectTaskInfo["id"],appId:s.selectTaskInfo["appId"],version:s.selectTaskInfo["version"],taskStatus:t};s.$axios.post("/"+s.system+"/changeStatus",a).then(function(t){t.data.success?s.$swal({type:"success",confirmButtonColor:"#4ae387",text:t.data.msg}).then(function(){s.$emit("refresh"),s.closeModal()}):s.$swal({type:"error",confirmButtonColor:"#4ae387",text:t.data.msg})})}})}}}),i=o,r=a("2877"),l=Object(r["a"])(i,s,n,!1,null,"41c27f41",null);e["a"]=l.exports}}]);
//# sourceMappingURL=chunk-03aa34e3.267d68a3.js.map